<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>AI 门户</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }
		body { overflow: hidden; background: #000; font-family: Helvetica, sans-serif; }
		#info { position: absolute; top: 12px; left: 12px; color: rgba(127,255,255,0.75); font-size: 14px; z-index: 10; }
		#info a { color: #8ff; }
		#container { width: 100%; height: 100vh; }
		#menu { position: absolute; bottom: 20px; width: 100%; text-align: center; z-index: 10; }
		.element {
			width: 120px; height: 160px;
			box-shadow: 0px 0px 12px rgba(0,255,255,0.5);
			border: 1px solid rgba(127,255,255,0.25);
			text-align: center; line-height: normal;
			cursor: pointer;
		}
		.element:hover {
			box-shadow: 0px 0px 12px rgba(0,255,255,0.75);
			border: 1px solid rgba(127,255,255,0.75);
		}
		.element .number { position: absolute; top: 20px; right: 20px; font-size: 12px; color: rgba(127,255,255,0.75); }
		.element .symbol { position: absolute; top: 40px; left: 0; right: 0; font-size: 36px; font-weight: bold; color: rgba(255,255,255,0.75); text-shadow: 0 0 10px rgba(0,255,255,0.95); }
		.element .details { position: absolute; bottom: 15px; left: 0; right: 0; font-size: 24px; color: rgba(127,255,255,0.75); }
		button {
			color: rgba(127,255,255,0.75); background: transparent;
			outline: 1px solid rgba(127,255,255,0.75); border: 0; padding: 5px 10px; cursor: pointer; margin: 0 4px;
		}
		button:hover { background-color: rgba(0,255,255,0.5); }
		button:active { color: #000; background-color: rgba(0,255,255,0.75); }
	</style>
</head>
<body>
	<div id="container"></div>
	<div id="menu">
		<button id="table">表格</button>
		<button id="sphere">球体</button>
		<button id="helix">螺旋</button>
		<button id="grid">网格</button>
	</div>
	<script>
		// 从父页面（Portal.tsx）注入的 src/data/portalSites.ts 数据优先；单独打开本页时使用下方兜底数据
		if (window.parent !== window && window.parent.__PORTAL_SITES__) {
			window.PORTAL_SITES = window.parent.__PORTAL_SITES__;
		} else {
			window.PORTAL_SITES = [
				{symbol:'通义',name:'通义千问',url:'https://tongyi.aliyun.com'},{symbol:'文心',name:'文心一言',url:'https://yiyan.baidu.com'},{symbol:'豆包',name:'豆包',url:'https://www.doubao.com'},{symbol:'智谱',name:'智谱清言',url:'https://chatglm.cn'},{symbol:'Coze',name:'Coze',url:'https://www.coze.cn'},{symbol:'GPT',name:'ChatGPT',url:'https://chat.openai.com'},{symbol:'Claude',name:'Claude',url:'https://claude.ai'},{symbol:'Kimi',name:'Kimi',url:'https://kimi.moonshot.cn'},{symbol:'DeepSeek',name:'DeepSeek',url:'https://www.deepseek.com'},{symbol:'Gemini',name:'Google Gemini',url:'https://gemini.google.com'},{symbol:'Dify',name:'Dify',url:'https://dify.ai'},{symbol:'Cursor',name:'Cursor',url:'https://cursor.com'},{symbol:'Phind',name:'Phind',url:'https://www.phind.com'},{symbol:'Perplexity',name:'Perplexity',url:'https://www.perplexity.ai'},{symbol:'Poe',name:'Poe',url:'https://poe.com'},{symbol:'Hugging',name:'Hugging Face',url:'https://huggingface.co'},{symbol:'Replicate',name:'Replicate',url:'https://replicate.com'},{symbol:'Ollama',name:'Ollama',url:'https://ollama.com'},{symbol:'LM Studio',name:'LM Studio',url:'https://lmstudio.ai'},{symbol:'Mistral',name:'Mistral',url:'https://mistral.ai'},{symbol:'Llama',name:'Llama',url:'https://llama.meta.com'},{symbol:'Midjourney',name:'Midjourney',url:'https://www.midjourney.com'},{symbol:'SD',name:'Stable Diffusion',url:'https://stability.ai'},{symbol:'Runway',name:'Runway',url:'https://runwayml.com'},{symbol:'Sora',name:'Sora',url:'https://openai.com/sora'},{symbol:'Vercel',name:'Vercel AI',url:'https://vercel.com/docs/ai'},{symbol:'Together',name:'Together',url:'https://together.ai'},{symbol:'Anthropic',name:'Anthropic',url:'https://www.anthropic.com'},{symbol:'OpenAI',name:'OpenAI',url:'https://openai.com'}
			];
		}
		// 元素周期表原始位置 (col, row)，与 periodictable 一致，前 30 个对应 PORTAL_SITES
		window.PORTAL_POSITIONS = [
			[1,1],[18,1],[1,2],[2,2],[13,2],[14,2],[15,2],[16,2],[17,2],[18,2],
			[1,3],[2,3],[13,3],[14,3],[15,3],[16,3],[17,3],[18,3],
			[1,4],[2,4],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4]
		];
		// 卡片大格显示化学元素符号（与周期表位置对应），详情仍为站点名称
		window.CHEMICAL_SYMBOLS = ['H','He','Li','Be','B','C','N','O','F','Ne','Na','Mg','Al','Si','P','S','Cl','Ar','K','Ca','Sc','Ti','V','Cr','Mn','Fe','Co','Ni','Cu'];
	</script>
	<script type="importmap">
		{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js","three/addons/":"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"}}
	</script>
	<script type="module">
		import * as THREE from 'three';
		import TWEEN from 'three/addons/libs/tween.module.js';
		import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
		import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';

		const sites = window.PORTAL_SITES;
		const positions = window.PORTAL_POSITIONS;
		const table = [];
		for (let i = 0; i < sites.length; i++) {
			const [col, row] = positions[i];
			table.push(sites[i].symbol, sites[i].name, '', col, row, sites[i].url);
		}

		let camera, scene, renderer, controls;
		const objects = [];
		const targets = { table: [], sphere: [], helix: [], grid: [] };

		function init() {
			camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
			camera.position.z = 3000;
			scene = new THREE.Scene();

			for (let i = 0; i < table.length; i += 6) {
				const element = document.createElement('div');
				element.className = 'element';
				element.style.backgroundColor = 'rgba(0,127,127,' + (Math.random() * 0.5 + 0.25) + ')';
				element.dataset.url = table[i + 5];
				element.addEventListener('click', function() { window.open(this.dataset.url, '_blank'); });

				const number = document.createElement('div');
				number.className = 'number';
				number.textContent = (i / 6) + 1;
				element.appendChild(number);

				const symbol = document.createElement('div');
				symbol.className = 'symbol';
				symbol.textContent = window.CHEMICAL_SYMBOLS[i / 6] || '';
				element.appendChild(symbol);

				const details = document.createElement('div');
				details.className = 'details';
				details.textContent = table[i + 1];
				element.appendChild(details);

				const objectCSS = new CSS3DObject(element);
				objectCSS.position.x = Math.random() * 4000 - 2000;
				objectCSS.position.y = Math.random() * 4000 - 2000;
				objectCSS.position.z = Math.random() * 4000 - 2000;
				scene.add(objectCSS);
				objects.push(objectCSS);

				const object = new THREE.Object3D();
				const stepX = 140, stepY = 180;
				const offsetX = 9.5 * stepX, offsetY = 5.5 * stepY;
				object.position.x = (table[i + 3] * stepX) - offsetX;
				object.position.y = -(table[i + 4] * stepY) + offsetY;
				targets.table.push(object);
			}

			const vector = new THREE.Vector3();
			for (let i = 0, l = objects.length; i < l; i++) {
				const phi = Math.acos(-1 + (2 * i) / l);
				const theta = Math.sqrt(l * Math.PI) * phi;
				const object = new THREE.Object3D();
				object.position.setFromSphericalCoords(800, phi, theta);
				vector.copy(object.position).multiplyScalar(2);
				object.lookAt(vector);
				targets.sphere.push(object);
			}

			for (let i = 0, l = objects.length; i < l; i++) {
				const theta = i * 0.175 + Math.PI;
				const y = -(i * 8) + 450;
				const object = new THREE.Object3D();
				object.position.setFromCylindricalCoords(900, theta, y);
				vector.x = object.position.x * 2;
				vector.y = object.position.y;
				vector.z = object.position.z * 2;
				object.lookAt(vector);
				targets.helix.push(object);
			}

			for (let i = 0; i < objects.length; i++) {
				const object = new THREE.Object3D();
				object.position.x = ((i % 5) * 400) - 800;
				object.position.y = (-(Math.floor(i / 5) % 5) * 400) + 800;
				object.position.z = (Math.floor(i / 25)) * 1000 - 2000;
				targets.grid.push(object);
			}

			renderer = new CSS3DRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.getElementById('container').appendChild(renderer.domElement);

			controls = new TrackballControls(camera, renderer.domElement);
			controls.minDistance = 500;
			controls.maxDistance = 6000;
			controls.addEventListener('change', render);

			document.getElementById('table').addEventListener('click', () => transform(targets.table, 2000));
			document.getElementById('sphere').addEventListener('click', () => transform(targets.sphere, 2000));
			document.getElementById('helix').addEventListener('click', () => transform(targets.helix, 2000));
			document.getElementById('grid').addEventListener('click', () => transform(targets.grid, 2000));

			transform(targets.table, 2000);
			window.addEventListener('resize', onWindowResize);
		}

		function transform(targets, duration) {
			TWEEN.removeAll();
			for (let i = 0; i < objects.length; i++) {
				const object = objects[i];
				const target = targets[i];
				new TWEEN.Tween(object.position).to({ x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration).easing(TWEEN.Easing.Exponential.InOut).start();
				new TWEEN.Tween(object.rotation).to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration).easing(TWEEN.Easing.Exponential.InOut).start();
			}
			new TWEEN.Tween({}).to({}, duration * 2).onUpdate(render).start();
		}

		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
			render();
		}

		function animate() {
			requestAnimationFrame(animate);
			TWEEN.update();
			controls.update();
		}

		function render() {
			renderer.render(scene, camera);
		}

		init();
		animate();
	</script>
</body>
</html>
